---
title: "Sleeping Measures"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

```{r setup, include = FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(collapse = TRUE, message = FALSE)
library(tidyverse)
library(gtsummary)

```

This data set includes four different measures of sleep: 

* `total_sleep_time`:	Average time in bed (the difference between wake time and bedtime) minus the length of total awake/restlessness in the main sleep episode, in minutes
* `bedtime_mssd`:	Mean successive squared difference of bedtime, a measure of variability in bedtimes between consecutive nights
* `midpoint_sleep`:	Average midpoint of bedtime and wake time, in minutes after 11 pm (for example, 364 is 5:04 am)
* `daytime_sleep`:	Average sleep time outside of the range of the main sleep episode, including short naps or sleep that occurred during the daytime, in minutes

The descriptions above were taken directly from the CMU S&DS Data Repository. 

## 

## Overall Sleeping Patterns {.tabset}

Below are plots describing the overall distributions of each of these sleep measures, broken down by university. We can observe that **COMMENTS**

```{r}
sleep_df <- read_csv("data/cmu-sleep.csv") %>% 
  janitor::clean_names() %>%  
  mutate(demo_race = case_when(demo_race == 0 ~ "Underrepresented", 
                                     demo_race == 1 ~ "Non-underrepresented"),
         demo_race = fct_relevel(demo_race, "Underrepresented"),
         demo_gender = case_when(demo_gender == 0 ~ "Male", 
                                     demo_gender == 1 ~ "Female"),
         demo_gender = fct_relevel(demo_gender, "Male"), 
         demo_firstgen = case_when(demo_firstgen == "0" ~ "Non-first gen", 
                                   demo_firstgen == "1" ~ "First-gen", 
                                   TRUE ~ NA),
         demo_firstgen = fct_relevel(demo_firstgen, "Non-first gen"), 
         time_collection = case_when(cohort == "lac1" ~ "Spring, 2018", 
                            cohort == "lac2" ~ "Spring, 2017",
                            cohort == "nh" ~ "Spring, 2016",
                            cohort == "uw1" ~ "Spring, 2018", 
                            cohort == "uw2" ~ "Spring, 2019"), 
         university = case_when(cohort == "lac1" ~ "CMU", 
                            cohort == "lac2" ~ "CMU",
                            cohort == "nh" ~ "NDU",
                            cohort == "uw1" ~ "UW", 
                            cohort == "uw2" ~ "UW"))

```

### Total Sleep Time {.tabset}

```{r}
plot_totalsleep <- sleep_df %>%  
  ggplot(aes(x = total_sleep_time, fill = university, color = university)) +
  geom_density(alpha = 0.3, linewidth = 1) +
  labs(x = "Total Sleep Time (minutes)", y = "Density") +
  theme_minimal() +
  theme(
    strip.text = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )

plot_totalsleep    
                          
```

```{r}

summary(lm(total_sleep_time ~ university, sleep_df)) %>% broom::tidy()

#boxplot(total_sleep_time ~ university, sleep_df)

```

### Variability in Bed Times {.tabset}

```{r}
plot_bedtime2 <- sleep_df %>%  
  ggplot(aes(x = bedtime_mssd, fill = university, color = university)) +
  geom_density(alpha = 0.3, linewidth = 1) +
  labs(x = "Mean Successive Squared Difference", y = "Density") +
  xlim(c(0,2.5))+
  theme_minimal() +
  theme(
    strip.text = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )

plot_bedtime2

```

```{r}

anova(lm(bedtime_mssd ~ university, sleep_df)) %>% broom::tidy()

```

### Sleeping Midpoint {.tabset}

```{r}
plot_midpoint <- sleep_df %>% 
  ggplot(aes(x = midpoint_sleep, fill = university, color = university)) +
  geom_density(alpha = 0.3, linewidth = 1) +
  labs(x = "Midpoint Sleep (minutes past 11 PM)", y = "Density") +
  theme_minimal() +
  theme(
    strip.text = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )

plot_midpoint

```

```{r}

mid_uni_anova <- anova(lm(midpoint_sleep ~ university, sleep_df)) %>% broom::tidy()

```

### Daytime Sleep {.tabset}

```{r}
plot_daysleep <- sleep_df %>% 
  ggplot(aes(x = daytime_sleep, fill = university, color = university)) +
  geom_density(alpha = 0.3, linewidth = 1) +
  labs(x = "Daytime Sleep (minutes)", y = "Density") +
  theme_minimal() +
  theme(
    strip.text = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )

plot_daysleep

```

```{r}

anova(lm(daytime_sleep ~ university, sleep_df)) %>% broom::tidy()

```

##

```{r}

sleep_df %>% select(total_sleep_time, bedtime_mssd, midpoint_sleep, daytime_sleep, university) %>% 
  tbl_summary(
    by = university,
    statistic = list(
      all_continuous() ~ "{median} ({p25}, {p75})",
      all_categorical() ~ "{n} / {N} ({p}%)")) %>% 
    add_p() %>% 
    add_overall()


```

## GPA and Courseload {.tabset}

everything below here is a work in progress/experimental lol

maybe some sort of heat map ??

```{r}

sleep_df %>% ggplot(aes(x = cum_gpa, y = zterm_units_zof_z)) +
  geom_density2d_filled(alpha = 0.8) +
  labs(
    x = "Cumulative GPA",
    y = "Term Units (Z)"
  ) +
  theme_minimal()

```

### Total Sleep Time {.tabset}

```{r}

sleep_df %>% drop_na(zterm_units_zof_z) %>% 
  ggplot(aes(x = plyr::round_any(cum_gpa, 0.5), y = round(zterm_units_zof_z), fill = total_sleep_time)) + 
  geom_tile() + scale_fill_gradient(low = "blue", high = "yellow") +
  labs(
    x = "Cumulative GPA",
    y = "Term Units (Z)",
    fill = "Total Sleep Time (min)"
  ) +
  theme_minimal()

```

### Variability in Bed Times {.tabset}

```{r}

sleep_df %>% drop_na(zterm_units_zof_z) %>% 
  ggplot(aes(x = plyr::round_any(cum_gpa, 0.5), y = round(zterm_units_zof_z), fill = bedtime_mssd)) + 
  geom_tile() + scale_fill_gradient(low = "blue", high = "yellow") +
  labs(
    x = "Cumulative GPA",
    y = "Term Units (Z)",
    fill = "MSSD"
  ) +
  theme_minimal()

```

### Sleeping Midpoint {.tabset}

```{r}

sleep_df %>% drop_na(zterm_units_zof_z) %>% 
  ggplot(aes(x = plyr::round_any(cum_gpa, 0.5), y = round(zterm_units_zof_z), fill = midpoint_sleep)) + 
  geom_tile() + scale_fill_gradient(low = "blue", high = "yellow") +
  labs(
    x = "Cumulative GPA",
    y = "Term Units (Z)",
    fill = "Minutes past 11 PM"
  ) +
  theme_minimal()

```

### Daytime Sleep {.tabset}

```{r}

sleep_df %>% drop_na(zterm_units_zof_z) %>% 
  ggplot(aes(x = plyr::round_any(cum_gpa, 0.5), y = round(zterm_units_zof_z), fill = daytime_sleep)) + 
  geom_tile() + scale_fill_gradient(low = "blue", high = "yellow") +
  labs(
    x = "Cumulative GPA",
    y = "Term Units (Z)",
    fill = "Daytime Sleep (min)"
  ) +
  theme_minimal()

```

## Gender {.tabset}

### Total Sleep Time {.tabset}

```{r}
plot_totalsleep <- sleep_df %>% filter(!is.na(demo_gender)) %>% 
  ggplot(aes(x = total_sleep_time, fill = demo_gender, color = demo_gender)) +
  geom_density(alpha = 0.3, linewidth = 1) + 
  labs(x = "Total Sleep Time (minutes)", y = "Density") +
  theme_minimal() +
  theme(
    strip.text = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5))

plot_totalsleep    
                          
```

### Variability in Bed Times {.tabset}

```{r}
plot_bedtime2 <- sleep_df %>% filter(!is.na(demo_gender)) %>%
  ggplot(aes(x = bedtime_mssd, fill = demo_gender, color = demo_gender)) +
  geom_density(alpha = 0.3, linewidth = 1) + 
  labs(x = "Mean Successive Squared Difference", y = "Density") +
  xlim(c(0,2.5))+
  theme_minimal() +
  theme(
    strip.text = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )

plot_bedtime2

```

### Sleeping Midpoint {.tabset}

```{r}
plot_midpoint <- sleep_df %>% filter(!is.na(demo_gender)) %>%
  ggplot(aes(x = midpoint_sleep, fill = demo_gender, color = demo_gender)) +
  geom_density(alpha = 0.3, linewidth = 1) +
  labs(x = "Midpoint Sleep (minutes past 11 PM)", y = "Density") +
  theme_minimal() +
  theme(
    strip.text = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )

plot_midpoint

```

```{r}
plot_midpoint1 <- sleep_df %>% filter(!is.na(demo_gender)) %>%
  ggplot(aes(x = midpoint_sleep, fill = demo_gender, color = demo_gender)) +
  geom_density(alpha = 0.3, linewidth = 1) + facet_grid(~university) +
  labs(x = "Midpoint Sleep (minutes past 11 PM)", y = "Density") +
  theme_minimal() +
  theme(
    strip.text = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )

plot_midpoint1

```

### Daytime Sleep {.tabset}

```{r}
plot_daysleep <- sleep_df %>% filter(!is.na(demo_gender)) %>% 
  ggplot(aes(x = daytime_sleep, fill = demo_gender, color = demo_gender)) +
  geom_density(alpha = 0.3, linewidth = 1) +
  labs(x = "Daytime Sleep (minutes)", y = "Density") +
  theme_minimal() +
  theme(
    strip.text = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )

plot_daysleep

```


## Underrepresented Students {.tabset}

**Comments**

### Total Sleep Time {.tabset}

```{r}
plot_totalsleep <- sleep_df %>% filter(!is.na(demo_race)) %>%
  ggplot(aes(x = total_sleep_time, fill = demo_race, color = demo_race)) +
  geom_density(alpha = 0.3, linewidth = 1) +
  labs(x = "Total Sleep Time (minutes)", y = "Density") +
  theme_minimal() +
  theme(
    strip.text = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )

plot_totalsleep    
                          
```

### Variability in Bed Times {.tabset}

```{r}
plot_bedtime2 <- sleep_df %>%  filter(!is.na(demo_race)) %>%
  ggplot(aes(x = bedtime_mssd, fill = demo_race, color = demo_race)) +
  geom_density(alpha = 0.3, linewidth = 1) +
  labs(x = "Mean Successive Squared Difference", y = "Density") +
  xlim(c(0,2.5))+
  theme_minimal() +
  theme(
    strip.text = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )

plot_bedtime2

```

### Sleeping Midpoint {.tabset}

```{r}
plot_midpoint <- sleep_df %>% filter(!is.na(demo_race)) %>%
  ggplot(aes(x = midpoint_sleep, fill = demo_race, color = demo_race)) +
  geom_density(alpha = 0.3, linewidth = 1) +
  labs(x = "Midpoint Sleep (minutes past 11 PM)", y = "Density") +
  theme_minimal() +
  theme(
    strip.text = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )

plot_midpoint

```

### Daytime Sleep {.tabset}

```{r}
plot_daysleep <- sleep_df %>% filter(!is.na(demo_race)) %>%
  ggplot(aes(x = daytime_sleep, fill = demo_race, color = demo_race)) +
  geom_density(alpha = 0.3, linewidth = 1) +
  labs(x = "Daytime Sleep (minutes)", y = "Density") +
  theme_minimal() +
  theme(
    strip.text = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )

plot_daysleep

```

## First-Generation Students {.tabset}

### Total Sleep Time {.tabset}

```{r}
plot_totalsleep <- sleep_df %>% filter(!is.na(demo_firstgen)) %>%
  ggplot(aes(x = total_sleep_time, fill = demo_firstgen, color = demo_firstgen)) +
  geom_density(alpha = 0.3, linewidth = 1) +
  labs(x = "Total Sleep Time (minutes)", y = "Density") +
  theme_minimal() +
  theme(
    strip.text = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )

plot_totalsleep    
                          
```

### Variability in Bed Times {.tabset}

```{r}
plot_bedtime2 <- sleep_df %>% filter(!is.na(demo_firstgen)) %>%
  ggplot(aes(x = bedtime_mssd, fill = demo_firstgen, color = demo_firstgen)) +
  geom_density(alpha = 0.3, linewidth = 1) +
  labs(x = "Mean Successive Squared Difference", y = "Density") +
  xlim(c(0,2.5))+
  theme_minimal() +
  theme(
    strip.text = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )

plot_bedtime2

```

### Sleeping Midpoint {.tabset}

```{r}
plot_midpoint <- sleep_df %>% filter(!is.na(demo_firstgen)) %>%
  ggplot(aes(x = midpoint_sleep, fill = demo_firstgen, color = demo_firstgen)) +
  geom_density(alpha = 0.3, linewidth = 1) +
  labs(x = "Midpoint Sleep (minutes past 11 PM)", y = "Density") +
  theme_minimal() +
  theme(
    strip.text = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )

plot_midpoint

```

### Daytime Sleep {.tabset}

```{r}
plot_daysleep <- sleep_df %>% filter(!is.na(demo_firstgen)) %>%
  ggplot(aes(x = daytime_sleep, fill = demo_firstgen, color = demo_firstgen)) +
  geom_density(alpha = 0.3, linewidth = 1) +
  labs(x = "Daytime Sleep (minutes)", y = "Density") +
  theme_minimal() +
  theme(
    strip.text = element_text(size = 14),
    plot.title = element_text(size = 16, face = "bold", hjust = 0.5)
  )

plot_daysleep

```
